concurrency:
  cancel-in-progress: true
  group: ${{ github.workflow }}-${{ github.ref }}
env:
  DEFAULT_MAVEN_OPTS: -Xmx4g -XX:ReservedCodeCacheSize=1g -XX:+UseG1GC -Dorg.slf4j.simpleLogger.defaultLogLevel=WARN
    -Daether.connector.http.retryHandler.count=5 -Daether.connector.http.connectionMaxTtl=30
    -Duser.language=en -Duser.country=GB -Duser.timezone=UTC
  MAVEN_BUILD_ARGUMENTS: verify -P skip-unit-tests -P integration-tests -P nifi-registry-integration-tests
  MAVEN_BUILD_EXCLUDE_PROJECTS: -pl -:minifi-assembly -pl -:nifi-assembly -pl -:nifi-toolkit-assembly
    -pl -:nifi-registry-assembly -pl -:nifi-registry-toolkit-assembly -pl -:nifi-runtime-manifest
    -pl -:nifi-runtime-manifest-test -pl -:nifi-stateless-assembly -pl -:nifi-stateless-system-test-suite
    -pl -:nifi-system-test-suite -pl -:nifi-nar-provider-assembly -pl -:nifi-py4j-integration-tests
    -pl -:nifi-docs -pl -:nifi-maven-archetypes -pl -:nifi-processor-bundle-archetype
    -pl -:nifi-service-bundle-archetype
  MAVEN_COMMAND: ./mvnw -V -nsu -ntp -ff
jobs:
  build_and_test:
    name: Ubuntu Java 21
    runs-on: self-hosted
    steps:
    - continue-on-error: true
      name: Checkout Code
      uses: actions/checkout@v4
    - continue-on-error: true
      name: Set up Java Zulu 21
      uses: actions/setup-java@v4
      with:
        cache: maven
        distribution: zulu
        java-version: 21
    - continue-on-error: true
      name: System Information
      run: 'hostname

        cat /proc/cpuinfo

        cat /proc/meminfo

        df

        docker info

        '
    - continue-on-error: true
      env:
        MAVEN_OPTS: ${{ env.DEFAULT_MAVEN_OPTS }}
      name: Build and Run Tests
      run: '${{ env.MAVEN_COMMAND }} ${{ env.MAVEN_BUILD_ARGUMENTS }} ${{ env.MAVEN_BUILD_EXCLUDE_PROJECTS
        }}

        '
    - continue-on-error: true
      if: failure() || cancelled()
      name: Upload Troubleshooting Logs
      uses: actions/upload-artifact@v4
      with:
        name: ubuntu-21-failsafe-logs
        path: '**/target/failsafe-reports/**/*.txt

          '
        retention-days: 7
    timeout-minutes: 120
name: integration-tests
on:
  repository_dispatch:
    types: trigger-ga___integration-tests.yml
permissions:
  contents: read
